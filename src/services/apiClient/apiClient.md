# Модуль API-клиентов (apiClient.ts)

## Назначение

Основная задача этого модуля — предоставлять сконфигурированные экземпляры (инстансы) `axios` для работы с API поставщиков. В качестве вспомогательной задачи, он также выполняет однократную проверку доступности прокси-сервера при запуске приложения, чтобы определить, нужно ли направлять запросы через него.

## Основные функции

### 1. `initProxyCheck()`

Эта функция должна быть вызвана **один раз** при запуске приложения, _перед_ созданием любых инстансов `axios`.

Ее задача — определить, нужно ли использовать прокси-сервер для всех последующих запросов.

1. **Локальная проверка:** Она получает IP-адрес сервера (`getLocalIP()`) и сравнивает его с `PROXY_HOST` из `.env`.
2. **Быстрый выход:** Если IP совпадают (сервер в той же сети, что и прокси), прокси **не используется** (`shouldUseProxy = false`), и проверка завершается.
3. **Тест "вживую":** Если IP _не_ совпадают, функция выполняет реальный тестовый запрос в интернет _через_ прокси (`checkProxy`). Только если этот тест проходит успешно, глобальный флаг `shouldUseProxy` устанавливается в `true`.

### 2. `createAxiosInstance()`

Эта функция — "фабрика" для создания инстансов `axios` под конкретного поставщика.

- **Аргумент:** Принимает `supplierKey` (например, `'ug'`).
- **Возвращает:** Готовый к работе инстанс `axios`.

Каждый созданный инстанс автоматически настраивается:

1. **BaseURL:** Устанавливается `baseURL` из конфига поставщика.
2. **Прокси:** Если `initProxyCheck` решил, что прокси нужен (`shouldUseProxy: true`), инстанс настраивается на работу через `HttpsProxyAgent`.
3. **Авторизация (Интерсептор запроса):** Если в конфиге поставщика стоит `needAuth: true`, **интерсептор запроса** автоматически добавляет `userlogin` и `userpsw` (в виде MD5) в параметры _каждого_ исходящего запроса.
4. **Повторы (Retry):** Инстанс оборачивается в `axios-retry` для автоматических повторных запросов в случае **таймаутов** (`ECONNABORTED`) или **сетевых/серверных ошибок 5xx**.
5. **Ошибка Прокси (Интерсептор ответа):** **Интерсептор ответа** специально отлавливает ошибку `ECONNREFUSED`, которая указывает на отказ прокси-сервера, и заменяет ее на более понятное сообщение об ошибке.
